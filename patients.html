<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org"
      th:replace="layout :: html(~{::title}, ~{::content}, ~{::scripts})">
<head>
  <title>患者管理 - 药品不良反应监测系统</title>
</head>
<body>
<div th:fragment="content">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-people text-primary"></i> 患者管理</h2>
    <div class="text-muted">
      共 <span th:text="${totalItems}">0</span> 条记录
    </div>
  </div>

  <!-- 搜索和筛选 -->
  <div class="card mb-4">
    <div class="card-body">
      <form class="row g-3">
        <div class="col-md-4">
          <input type="text" class="form-control" placeholder="搜索患者姓名或编号...">
        </div>
        <div class="col-md-2">
          <select class="form-select">
            <option>全部性别</option>
            <option>男</option>
            <option>女</option>
          </select>
        </div>
        <div class="col-md-3">
          <input type="text" class="form-control" placeholder="地区筛选...">
        </div>
        <div class="col-md-3">
          <button type="submit" class="btn btn-primary w-100">
            <i class="bi bi-search"></i> 搜索
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- 患者表格 -->
  <div class="card">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead class="table-light">
          <tr>
            <th>患者编号</th>
            <th>姓名</th>
            <th>性别</th>
            <th>出生日期</th>
            <th>地区</th>
            <th>用药记录</th>
            <th>不良反应</th>
            <th>操作</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="patient : ${patients}">
            <td th:text="${patient.patientCode}">-</td>
            <td th:text="${patient.name}">-</td>
            <td th:text="${patient.gender}">-</td>
            <td th:text="${patient.birthDate != null ? #temporals.format(patient.birthDate, 'yyyy-MM-dd') : '-'}">-</td>
            <td th:text="${patient.region}">-</td>
            <td>
              <span class="badge bg-primary" th:text="${patient.medicationRecords.size()}">0</span>
            </td>
            <td>
              <span class="badge bg-warning" th:text="${patient.adverseReactionRecords.size()}">0</span>
            </td>
            <td>
              <a th:href="@{/patients/{id}(id=${patient.patientCode})}"
                 class="btn btn-sm btn-outline-primary">
                <i class="bi bi-eye"></i> 详情
              </a>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- 分页 -->
      <nav th:if="${totalPages > 1}">
        <ul class="pagination justify-content-center">
          <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
            <a class="page-link" th:href="@{/patients(page=0, size=${pageSize})}">首页</a>
          </li>
          <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
            <a class="page-link" th:href="@{/patients(page=${currentPage - 1}, size=${pageSize})}">上一页</a>
          </li>

          <li th:each="page : ${#numbers.sequence(0, totalPages - 1)}"
              class="page-item" th:classappend="${page == currentPage} ? 'active'">
            <a class="page-link" th:href="@{/patients(page=${page}, size=${pageSize})}"
               th:text="${page + 1}">1</a>
          </li>

          <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
            <a class="page-link" th:href="@{/patients(page=${currentPage + 1}, size=${pageSize})}">下一页</a>
          </li>
          <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
            <a class="page-link" th:href="@{/patients(page=${totalPages - 1}, size=${pageSize})}">末页</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<div th:fragment="scripts">
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 患者页面特定脚本
    });
  </script>
</div>
</body>
</html>